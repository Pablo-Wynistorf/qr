<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    select option { background:#1e293b; color:#e2e8f0 }
    ::-webkit-scrollbar{width:5px}
    ::-webkit-scrollbar-thumb{background:#334155;border-radius:4px}
  </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen p-4 sm:p-8">

<div id="toast" class="fixed bottom-6 right-6 z-50 hidden bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm shadow-lg">‚úì Copied!</div>

<div class="max-w-5xl mx-auto">
  <div class="text-center mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-white mb-1">üì± QR Code Generator</h1>
    <p class="text-slate-400 text-sm">URLs, contacts, WiFi, and more ‚Äî 100% offline, no API calls</p>
  </div>

  <div class="grid lg:grid-cols-5 gap-6">
    <div class="lg:col-span-3 space-y-5">
      <!-- Type -->
      <div class="bg-slate-900 rounded-xl border border-slate-800 p-4">
        <label class="text-xs font-medium text-slate-500 uppercase tracking-wide block mb-3">Type</label>
        <div class="grid grid-cols-3 sm:grid-cols-4 gap-2" id="typeGrid"></div>
      </div>
      <!-- Form -->
      <div class="bg-slate-900 rounded-xl border border-slate-800 p-4">
        <h2 class="text-sm font-semibold text-white mb-3" id="formTitle">URL / Website</h2>
        <div id="formContainer" class="space-y-3"></div>
      </div>
      <!-- Options -->
      <div class="bg-slate-900 rounded-xl border border-slate-800 p-4">
        <label class="text-xs font-medium text-slate-500 uppercase tracking-wide block mb-3">Options</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-500 mb-1 block">Size</label>
            <select id="qrSize" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm outline-none focus:border-indigo-500">
              <option value="160">Small</option>
              <option value="230" selected>Medium</option>
              <option value="320">Large</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-slate-500 mb-1 block">Error Correction</label>
            <select id="qrEC" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm outline-none focus:border-indigo-500">
              <option value="L">Low</option>
              <option value="M" selected>Medium</option>
              <option value="Q">Quartile</option>
              <option value="H">High</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-slate-500 mb-1 block">Foreground</label>
            <div class="flex gap-2 items-center">
              <input type="color" id="fgColor" value="#ffffff" class="w-9 h-9 rounded border border-slate-700 bg-slate-800 cursor-pointer p-0.5">
              <input type="text" id="fgHex" value="#ffffff" maxlength="7" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-2 py-2 text-xs font-mono outline-none focus:border-indigo-500">
            </div>
          </div>
          <div>
            <label class="text-xs text-slate-500 mb-1 block">Background</label>
            <div class="flex gap-2 items-center">
              <input type="color" id="bgColor" value="#0b1120" class="w-9 h-9 rounded border border-slate-700 bg-slate-800 cursor-pointer p-0.5">
              <input type="text" id="bgHex" value="#0b1120" maxlength="7" class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-2 py-2 text-xs font-mono outline-none focus:border-indigo-500">
            </div>
          </div>
        </div>
      </div>
      <button onclick="generateQR()" class="lg:hidden w-full bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 rounded-xl transition">Generate QR Code</button>
    </div>

    <!-- Preview -->
    <div class="lg:col-span-2">
      <div class="bg-slate-900 rounded-xl border border-slate-800 p-5 lg:sticky lg:top-6">
        <button onclick="generateQR()" class="hidden lg:block w-full bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 rounded-xl transition mb-5">Generate QR Code</button>
        <div class="text-center">
          <div id="qrPlaceholder" class="py-14">
            <div class="text-4xl mb-2">üì∑</div>
            <p class="text-slate-500 text-sm">QR code appears here</p>
          </div>
          <div id="qrResult" class="hidden">
            <div id="qrCode" class="inline-block p-3 bg-slate-800 rounded-xl"></div>
            <p id="qrDataText" class="text-xs text-slate-500 font-mono break-all mt-3 max-h-16 overflow-y-auto text-left bg-slate-800 rounded-lg p-2"></p>
            <div class="grid grid-cols-3 gap-2 mt-4">
              <button onclick="downloadPNG()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 rounded-lg transition">üì• PNG</button>
              <button onclick="downloadSVG()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 rounded-lg transition">üìê SVG</button>
              <button onclick="copyImage()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 rounded-lg transition">üìã Copy</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const TYPES = [
  { id:'url',      label:'URL',      icon:'üîó' },
  { id:'text',     label:'Text',     icon:'üìù' },
  { id:'email',    label:'Email',    icon:'‚úâÔ∏è' },
  { id:'phone',    label:'Phone',    icon:'üìû' },
  { id:'sms',      label:'SMS',      icon:'üí¨' },
  { id:'wifi',     label:'WiFi',     icon:'üì∂' },
  { id:'vcard',    label:'Contact',  icon:'üë§' },
  { id:'event',    label:'Event',    icon:'üìÖ' },
  { id:'geo',      label:'Location', icon:'üìç' },
  { id:'bitcoin',  label:'Bitcoin',  icon:'‚Çø' },
  { id:'whatsapp', label:'WhatsApp', icon:'üíö' },
  { id:'paypal',   label:'PayPal',   icon:'üí∞' },
];

const FORMS = {
  url:      [{ id:'url', label:'Website URL', type:'url', ph:'https://example.com' }],
  text:     [{ id:'text', label:'Text', type:'textarea', ph:'Enter any text...' }],
  email:    [
    { id:'to', label:'Email Address', type:'email', ph:'name@example.com' },
    { id:'subject', label:'Subject', type:'text', ph:'Subject line' },
    { id:'body', label:'Body', type:'textarea', ph:'Email body...' }
  ],
  phone:    [{ id:'phone', label:'Phone Number', type:'tel', ph:'+1 555 123 4567' }],
  sms:      [
    { id:'phone', label:'Phone Number', type:'tel', ph:'+1 555 123 4567' },
    { id:'message', label:'Message', type:'textarea', ph:'Your message...' }
  ],
  wifi:     [
    { id:'ssid', label:'Network Name (SSID)', type:'text', ph:'MyWiFi' },
    { id:'password', label:'Password', type:'text', ph:'password123' },
    { id:'encryption', label:'Encryption', type:'select', options:['WPA','WEP','nopass'] },
    { id:'hidden', label:'Hidden Network', type:'select', options:['No','Yes'] }
  ],
  vcard:    [
    { id:'fn', label:'First Name', type:'text', ph:'John' },
    { id:'ln', label:'Last Name', type:'text', ph:'Doe' },
    { id:'phone', label:'Phone', type:'tel', ph:'+1 555 123 4567' },
    { id:'email', label:'Email', type:'email', ph:'john@example.com' },
    { id:'org', label:'Company', type:'text', ph:'Acme Inc.' },
    { id:'title', label:'Job Title', type:'text', ph:'Developer' },
    { id:'url', label:'Website', type:'url', ph:'https://example.com' },
    { id:'address', label:'Address', type:'text', ph:'123 Main St, City' }
  ],
  event:    [
    { id:'title', label:'Event Title', type:'text', ph:'Team Meeting' },
    { id:'location', label:'Location', type:'text', ph:'Room 4' },
    { id:'start', label:'Start', type:'datetime-local' },
    { id:'end', label:'End', type:'datetime-local' },
    { id:'desc', label:'Description', type:'textarea', ph:'Details...' }
  ],
  geo:      [
    { id:'lat', label:'Latitude', type:'text', ph:'40.7128' },
    { id:'lng', label:'Longitude', type:'text', ph:'-74.0060' }
  ],
  bitcoin:  [
    { id:'address', label:'Bitcoin Address', type:'text', ph:'1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa' },
    { id:'amount', label:'Amount (BTC)', type:'text', ph:'0.001' },
    { id:'label', label:'Label', type:'text', ph:'Donation' }
  ],
  whatsapp: [
    { id:'phone', label:'Phone (with country code)', type:'tel', ph:'+1 555 123 4567' },
    { id:'message', label:'Message', type:'textarea', ph:'Hello!' }
  ],
  paypal:   [
    { id:'email', label:'PayPal Email', type:'email', ph:'you@example.com' },
    { id:'amount', label:'Amount', type:'text', ph:'10.00' },
    { id:'currency', label:'Currency', type:'select', options:['USD','EUR','GBP','CAD','AUD','JPY'] },
    { id:'description', label:'Description', type:'text', ph:'Payment for...' }
  ]
};

let selected = 'url';
let qrObj = null;
let lastData = '';

// Build type grid
const grid = document.getElementById('typeGrid');
TYPES.forEach(t => {
  const b = document.createElement('button');
  b.dataset.type = t.id;
  b.className = typeClass(t.id === selected);
  b.innerHTML = `<span>${t.icon}</span>${t.label}`;
  b.onclick = () => pickType(t.id);
  grid.appendChild(b);
});

function typeClass(active) {
  return `flex items-center gap-1.5 px-3 py-2 rounded-lg border text-xs font-medium transition cursor-pointer ${active ? 'border-indigo-500 bg-indigo-500/10 text-indigo-300' : 'border-slate-700 bg-slate-800 text-slate-400 hover:border-slate-600'}`;
}

function pickType(id) {
  selected = id;
  document.querySelectorAll('#typeGrid button').forEach(b => b.className = typeClass(b.dataset.type === id));
  document.getElementById('formTitle').textContent = TYPES.find(t => t.id === id).label;
  buildForm();
}

function buildForm() {
  const c = document.getElementById('formContainer');
  c.innerHTML = '';
  (FORMS[selected] || []).forEach(f => {
    const wrap = document.createElement('div');
    const lbl = document.createElement('label');
    lbl.className = 'text-xs text-slate-400 mb-1 block';
    lbl.textContent = f.label;
    wrap.appendChild(lbl);

    let input;
    if (f.type === 'textarea') {
      input = document.createElement('textarea');
      input.rows = 3;
    } else if (f.type === 'select') {
      input = document.createElement('select');
      f.options.forEach(o => {
        const opt = document.createElement('option');
        opt.value = o; opt.textContent = o;
        input.appendChild(opt);
      });
    } else {
      input = document.createElement('input');
      input.type = f.type;
    }
    input.id = 'f_' + f.id;
    input.placeholder = f.ph || '';
    input.className = 'w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm outline-none focus:border-indigo-500 transition text-slate-200 placeholder-slate-600';
    wrap.appendChild(input);
    c.appendChild(wrap);
  });
}

function val(id) {
  const el = document.getElementById('f_' + id);
  return el ? el.value.trim() : '';
}

function buildData() {
  switch (selected) {
    case 'url':
      return val('url') || 'https://example.com';
    case 'text':
      return val('text');
    case 'email': {
      let s = `mailto:${val('to')}`;
      const p = [];
      if (val('subject')) p.push('subject=' + encodeURIComponent(val('subject')));
      if (val('body')) p.push('body=' + encodeURIComponent(val('body')));
      if (p.length) s += '?' + p.join('&');
      return s;
    }
    case 'phone':
      return `tel:${val('phone')}`;
    case 'sms': {
      let s = `sms:${val('phone')}`;
      if (val('message')) s += `?body=${encodeURIComponent(val('message'))}`;
      return s;
    }
    case 'wifi': {
      const enc = val('encryption');
      const hidden = val('hidden') === 'Yes' ? 'H:true' : '';
      return `WIFI:T:${enc};S:${val('ssid')};P:${val('password')};${hidden};`;
    }
    case 'vcard':
      return [
        'BEGIN:VCARD',
        'VERSION:3.0',
        `N:${val('ln')};${val('fn')}`,
        `FN:${val('fn')} ${val('ln')}`,
        val('phone') ? `TEL:${val('phone')}` : '',
        val('email') ? `EMAIL:${val('email')}` : '',
        val('org') ? `ORG:${val('org')}` : '',
        val('title') ? `TITLE:${val('title')}` : '',
        val('url') ? `URL:${val('url')}` : '',
        val('address') ? `ADR:;;${val('address')}` : '',
        'END:VCARD'
      ].filter(Boolean).join('\n');
    case 'event': {
      const fmt = d => d ? d.replace(/[-:]/g, '').replace('T', 'T') + '00' : '';
      return [
        'BEGIN:VEVENT',
        `SUMMARY:${val('title')}`,
        val('location') ? `LOCATION:${val('location')}` : '',
        val('start') ? `DTSTART:${fmt(val('start'))}` : '',
        val('end') ? `DTEND:${fmt(val('end'))}` : '',
        val('desc') ? `DESCRIPTION:${val('desc')}` : '',
        'END:VEVENT'
      ].filter(Boolean).join('\n');
    }
    case 'geo':
      return `geo:${val('lat')},${val('lng')}`;
    case 'bitcoin': {
      let s = `bitcoin:${val('address')}`;
      const p = [];
      if (val('amount')) p.push('amount=' + val('amount'));
      if (val('label')) p.push('label=' + encodeURIComponent(val('label')));
      if (p.length) s += '?' + p.join('&');
      return s;
    }
    case 'whatsapp': {
      const phone = val('phone').replace(/[^0-9]/g, '');
      let s = `https://wa.me/${phone}`;
      if (val('message')) s += `?text=${encodeURIComponent(val('message'))}`;
      return s;
    }
    case 'paypal': {
      let s = `https://www.paypal.com/paypalme/${val('email')}`;
      if (val('amount')) s += `/${val('amount')}${val('currency') || 'USD'}`;
      return s;
    }
    default:
      return '';
  }
}

function generateQR() {
  const data = buildData();
  if (!data) { alert('Please fill in at least one field.'); return; }
  lastData = data;

  const size = parseInt(document.getElementById('qrSize').value);
  const ec = document.getElementById('qrEC').value;
  const fg = document.getElementById('fgHex').value;
  const bg = document.getElementById('bgHex').value;

  const codeEl = document.getElementById('qrCode');
  codeEl.innerHTML = '';

  const ecMap = { L: QRCode.CorrectLevel.L, M: QRCode.CorrectLevel.M, Q: QRCode.CorrectLevel.Q, H: QRCode.CorrectLevel.H };
  qrObj = new QRCode(codeEl, {
    text: data,
    width: size,
    height: size,
    colorDark: fg,
    colorLight: bg,
    correctLevel: ecMap[ec] || QRCode.CorrectLevel.M
  });

  document.getElementById('qrDataText').textContent = data;
  document.getElementById('qrPlaceholder').classList.add('hidden');
  document.getElementById('qrResult').classList.remove('hidden');
}

function getCanvas() {
  return document.querySelector('#qrCode canvas');
}

function downloadPNG() {
  const canvas = getCanvas();
  if (!canvas) return;
  const a = document.createElement('a');
  a.download = 'qrcode.png';
  a.href = canvas.toDataURL('image/png');
  a.click();
}

function downloadSVG() {
  const canvas = getCanvas();
  if (!canvas) return;
  const w = canvas.width, h = canvas.height;
  const ctx = canvas.getContext('2d');
  const img = ctx.getImageData(0, 0, w, h);
  const bg = document.getElementById('bgHex').value;
  const fg = document.getElementById('fgHex').value;

  let moduleSize = 1;
  for (let x = 0; x < w; x++) {
    const idx = x * 4;
    const r = img.data[idx], g = img.data[idx+1], b = img.data[idx+2];
    if (x > 0) {
      const pr = img.data[(x-1)*4], pg = img.data[(x-1)*4+1], pb = img.data[(x-1)*4+2];
      if (Math.abs(r-pr) + Math.abs(g-pg) + Math.abs(b-pb) > 100) {
        moduleSize = x;
        break;
      }
    }
  }
  if (moduleSize < 1) moduleSize = 1;
  const count = Math.round(w / moduleSize);

  let rects = '';
  for (let row = 0; row < count; row++) {
    for (let col = 0; col < count; col++) {
      const px = Math.floor(col * moduleSize + moduleSize / 2);
      const py = Math.floor(row * moduleSize + moduleSize / 2);
      if (px < w && py < h) {
        const idx = (py * w + px) * 4;
        const lum = img.data[idx] * 0.299 + img.data[idx+1] * 0.587 + img.data[idx+2] * 0.114;
        if (lum < 128) {
          rects += `<rect x="${col}" y="${row}" width="1" height="1" fill="${fg}"/>`;
        }
      }
    }
  }

  const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${count} ${count}" width="${w}" height="${h}"><rect width="${count}" height="${count}" fill="${bg}"/>${rects}</svg>`;
  const blob = new Blob([svg], { type: 'image/svg+xml' });
  const a = document.createElement('a');
  a.download = 'qrcode.svg';
  a.href = URL.createObjectURL(blob);
  a.click();
  URL.revokeObjectURL(a.href);
}

async function copyImage() {
  const canvas = getCanvas();
  if (!canvas) return;
  try {
    const blob = await new Promise(r => canvas.toBlob(r, 'image/png'));
    await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
    showToast();
  } catch {
    try {
      await navigator.clipboard.writeText(lastData);
      showToast();
    } catch { alert('Copy failed. Try downloading instead.'); }
  }
}

function showToast() {
  const t = document.getElementById('toast');
  t.classList.remove('hidden');
  setTimeout(() => t.classList.add('hidden'), 2200);
}

// Color sync
document.getElementById('fgColor').addEventListener('input', e => { document.getElementById('fgHex').value = e.target.value; });
document.getElementById('bgColor').addEventListener('input', e => { document.getElementById('bgHex').value = e.target.value; });
document.getElementById('fgHex').addEventListener('input', e => { if (/^#[0-9a-f]{6}$/i.test(e.target.value)) document.getElementById('fgColor').value = e.target.value; });
document.getElementById('bgHex').addEventListener('input', e => { if (/^#[0-9a-f]{6}$/i.test(e.target.value)) document.getElementById('bgColor').value = e.target.value; });

// Init
buildForm();
</script>
</body>
</html>
